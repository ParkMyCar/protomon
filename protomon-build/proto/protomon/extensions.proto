// Protomon code generation extensions.
//
// Import this file in your .proto files to use protomon-specific options:
//
//   import "protomon/extensions.proto";
//
//   message MyMessage {
//     repeated string tags = 1 [(protomon.vec) = true];
//     optional MyMessage child = 2 [(protomon.boxed) = true];
//   }
//
// Extension Field Number Range:
//   Protomon reserves field numbers 50001-50099 for its extensions.
//   This range is within the user-defined extension range (1-536870911)
//   and avoids conflicts with Google's reserved ranges.
//
//   Current allocations:
//     50000 - nullable: Make oneof nullable (default true)
//     50001 - vec: Use Vec<T> for repeated fields
//     50002 - boxed: Wrap field in Box<T>
//     50003 - lazy: Wrap message in LazyMessage<T>
//     50004 - fixed_array: Use [u8; N] for bytes fields
//     50005 - map_type: Map type ("btree" or "hash") for map fields
//     50006-50009 - Reserved for future field options
//     50010-50019 - Reserved for future message options
//     50020-50029 - Reserved for future enum options
//     50030-50039 - Reserved for future file options
//     50040-50049 - Reserved for future oneof options

syntax = "proto3";

package protomon;

import "google/protobuf/descriptor.proto";

// Field-level options for customizing generated Rust code.
extend google.protobuf.FieldOptions {
  // Use Vec<T> instead of the default type.
  // For repeated fields: Use Vec<T> instead of Repeated<T>.
  //   Repeated<T> is lazy and zero-copy, Vec<T> is eager and owns the data.
  // For bytes fields: Use Vec<u8> instead of ProtoBytes.
  //   ProtoBytes wraps bytes::Bytes, Vec<u8> is a standard Rust vector.
  // Only valid on repeated fields or bytes fields.
  bool vec = 50001;

  // Wrap the field type in Box<T>.
  // Useful for breaking recursive type cycles in message definitions.
  // For optional fields: generates Option<Box<T>> (None doesn't allocate).
  // For repeated fields: generates Vec<Box<T>> or Repeated<Box<T>>.
  bool boxed = 50002;

  // Wrap the message field in LazyMessage<T> for lazy/zero-copy decoding.
  // The message is not decoded until accessed, and borrows from the input buffer.
  // Only valid on message-type fields; errors if used on scalar fields.
  bool lazy = 50003;

  // Use a fixed-size array [u8; N] instead of ProtoBytes for bytes fields.
  // The value specifies the array size (max 32, due to Rust's Default trait).
  // Useful for fixed-size data like hashes (32 bytes) or UUIDs (16 bytes).
  // Only valid on bytes fields; errors if used on other field types.
  // Example: bytes hash = 1 [(protomon.fixed_array) = 32];  // [u8; 32]
  uint32 fixed_array = 50004;

  // Map type to use for map fields.
  // Values: "btree" (default) or "hash".
  // BTreeMap is the default because it only requires `alloc`.
  // HashMap requires the `std` feature in protomon.
  // Only valid on map fields; errors if used on other field types.
  // Example: map<string, int32> scores = 1 [(protomon.map_type) = "hash"];
  string map_type = 50005;
}

// Oneof-level options for customizing generated Rust code.
extend google.protobuf.OneofOptions {
  // Whether the oneof field is nullable (wrapped in Option<T>).
  // Default is true: generates `pub widget: Option<Widget>`.
  // When set to false: generates `pub widget: Widget` and decoding fails
  // if the oneof is missing from wire data.
  //
  // Example:
  //   message MyMessage {
  //     oneof widget {
  //       option (protomon.nullable) = false;
  //       int32 int_field = 2;
  //       string string_field = 3;
  //     }
  //   }
  bool nullable = 50000;
}

// Message-level options for customizing generated Rust code.
extend google.protobuf.MessageOptions {
  // Preserve unknown fields for round-trip compatibility.
  // When set to true, adds a `_unknown: bytes::Bytes` field to the message
  // that stores any unrecognized fields encountered during decoding.
  // These fields are re-serialized during encoding.
  // Useful for proxy scenarios where messages are forwarded without
  // understanding all fields.
  //
  // Example:
  //   message MyMessage {
  //     option (protomon.preserve_unknown) = true;
  //     string name = 1;
  //   }
  bool preserve_unknown = 50010;
}
